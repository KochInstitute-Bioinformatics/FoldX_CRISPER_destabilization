params {
    // Input parameters
    mutation_csv = null
    structure_dir = null
    outdir = "results"
    
    // FoldX parameters
    foldx_path = "foldx_20251231"
    chain = "A"
    number_of_runs = 5
    
    // Container settings
    singularity_enabled = false
    docker_enabled = false
}

// Process configuration
process {
    // Default container
    container = "docker://ubuntu:20.04"
    
    withName: 'GENERATE_MUTATION_FILES' {
        container = "docker://jupyter/scipy-notebook:latest"
    }
    
    withName: 'REPAIR_STRUCTURES' {
        container = "docker://bumproo/foldx5"
    }
    
    withName: 'RUN_BUILDMODEL' {
        container = "docker://bumproo/foldx5"
    }
    
    withName: 'CALCULATE_DDG' {
        container = "docker://jupyter/scipy-notebook:latest"
    }
}

// Profile configurations
profiles {
    docker {
        docker.enabled = true
        docker.runOptions = '-u $(id -u):$(id -g)'
    }
    
    singularity {
        singularity.enabled = true
        singularity.autoMounts = true
    }
    
    test {
        params.number_of_runs = 1
    }
}

// Capture exit codes from upstream processes when piping
process.shell = ['/bin/bash', '-euo', 'pipefail']

// Execution reports
timeline {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_timeline.html"
    overwrite = true
}

report {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_report.html"
    overwrite = true
}

trace {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_trace.txt"
    overwrite = true
}

dag {
    enabled = true
    file = "${params.outdir}/pipeline_info/pipeline_dag.svg"
    overwrite = true
}