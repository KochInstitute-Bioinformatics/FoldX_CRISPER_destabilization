params {
    // Input parameters
    mutation_csv = null
    structure_dir = "/net/bmc-lab3/data/bcc/projects/paulinar-SanchezRivera/080125_workflow/testing/pdb_files"
    repaired_structures_dir = "/net/bmc-lab3/data/bcc/projects/paulinar-SanchezRivera/080125_workflow/testing/repaired_pdb_files"
    outdir = "results"
    
    // FoldX parameters
    foldx_path = "foldx_20251231"
    chain = "A"
    number_of_runs = 5
}

process {
    // Default SLURM settings for all processes
    executor = 'slurm'
    cpus = 1
    memory = '4.GB'
    time = '1.h'
    queue = 'bcc'
    
    // Container and resource specifications per process
    withName: 'GENERATE_MUTATION_FILES' {
        container = "jupyter/scipy-notebook:latest"
        cpus = 1
        memory = '2.GB'
        time = '30.min'
    }
    withName: 'REPAIR_STRUCTURES_CONDITIONAL' {
        container = "bumproo/foldx5"
        cpus = 1
        memory = '8.GB'
        time = '2.h'
        // This is the slow step, so give it more resources
    }
    withName: 'RUN_BUILDMODEL' {
        container = "bumproo/foldx5"
        cpus = 1
        memory = '4.GB'
        time = '2.h'
    }
    withName: 'CALCULATE_DDG' {
        container = "jupyter/scipy-notebook:latest"
        cpus = 1
        memory = '4.GB'
        time = '1.h'
    }
    withName: 'WRITE_MISSING_GENES' {
        container = "jupyter/scipy-notebook:latest"
        cpus = 1
        memory = '1.GB'
        time = '10.min'
    }
}

profiles {
    singularity {
        singularity.enabled = true
        singularity.autoMounts = true
    }
    slurm {
        process.executor = 'slurm'
        executor {
            queueSize = 12  // Maximum 12 jobs running at once
            submitRateLimit = '10/1min'  // Submit 5 jobs per minute max
        }
    }
}

// Executor configuration for SLURM
executor {
    name = 'slurm'
    queueSize = 12  // Maximum number of jobs to submit at once
    submitRateLimit = '10/1min'  // Submit rate limit - conservative to avoid overwhelming scheduler
}

// Execution reports
timeline {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_timeline.html"
}
report {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_report.html"
}
trace {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_trace.txt"
}
dag {
    enabled = true
    file = "${params.outdir}/pipeline_info/pipeline_dag.svg"
}